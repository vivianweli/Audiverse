<h1>
  <label>Audio List</label>
</h1>

<!-- Tag Filter -->
<div class="filter">
  <label for="tag-filter">Filter by tag:</label>
  <select id="tag-filter">
    <option value="all">All</option>
    <% tags.forEach(tag => { %>
      <option value="<%= tag %>"><%= tag %></option>
    <% }); %>
  </select>
</div>

<!-- Audio List -->
<div id="audio-list">
  <% if (sounds.length === 0) { %>
    <p>No audio available for this tag.</p>
  <% } else { %>
    <% sounds.forEach(audio => { %>
      <div class="audio-item">
        <h2><a href="/sound/<%= audio.id %>"><%= audio.title %></a></h2>
        <p class="tags">
          <% if (!audio.tags || audio.tags === '') { %>
            No tags
          <% } else if (Array.isArray(audio.tags)) { %>
            Tags: <%= audio.tags.join(', ') %>
          <% } else { %>
            Tag: <%= audio.tags %>
          <% } %>
        </p>
        <p>Uploader: <%= audio.uploader %> | Likes: <%= audio.likes %> | Duration: <%= audio.duration %></p>
      </div>
    <% }); %>
  <% } %>
</div>

<!-- Pagination Controls -->
<div class="pagination">
  <% if (currentPage > 1) { %>
    <a href="?page=<%= currentPage - 1 %>">Previous</a>
  <% } %>

  <span>Page <%= currentPage %> of <%= totalPages %></span>

  <% if (currentPage < totalPages) { %>
    <a href="?page=<%= currentPage + 1 %>">Next</a>
  <% } %>
</div>

<script>
  // Injected data from EJS to JavaScript
  let audioData = <%- JSON.stringify(sounds) %>;
  let allTags = <%- JSON.stringify(tags) %>;

  // Event listener for tag filter
  document.getElementById('tag-filter').addEventListener('change', filterByTag);

  function filterByTag() {
    const selectedTag = document.getElementById('tag-filter').value;
    let filteredAudios;

    if (selectedTag === 'all') {
      filteredAudios = audioData;
    } else {
      filteredAudios = audioData.filter(audio => {
        // Ensure audio.tags is always an array
        let audioTags = Array.isArray(audio.tags) ? audio.tags : (audio.tags ? audio.tags.split(',').map(tag => tag.trim()) : []);
        return audioTags.includes(selectedTag);
      });
    }

    displayAudios(filteredAudios);
  }

  function displayAudios(audios) {
    const audioList = document.getElementById('audio-list');
    audioList.innerHTML = ''; // Clear the list

    if (audios.length === 0) {
      audioList.innerHTML = '<p>No audio available for this tag.</p>';
      return;
    }

    audios.forEach(audio => {
      const div = document.createElement('div');
      div.className = 'audio-item';
      let tagMessage;

      // Ensure audio.tags is always an array
      let audioTags = Array.isArray(audio.tags) ? audio.tags : (audio.tags ? audio.tags.split(',').map(tag => tag.trim()) : []);

      if (audioTags.length === 0) {
        tagMessage = 'No tags';
      } else {
        tagMessage = `Tags: ${audioTags.join(', ')}`;
      }

      div.innerHTML = `
        <h2><a href="/sound/${audio.id}">${audio.title}</a></h2>
        <p class="tags">${tagMessage}</p>
        <p>Uploader: ${audio.uploader} | Likes: ${audio.likes} | Duration: ${audio.duration}</p>
      `;
      audioList.appendChild(div);
    });
  }
</script>
